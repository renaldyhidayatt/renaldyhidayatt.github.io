---
title: 'Distributed Modular Monolith Payment Gateway Rust'
excerpt: 'A Distributed Modular Monolith Payment Gateway Platform built with Rust, gRPC, PostgreSQL'
date: '2025-08-27'
tags:
  [
    'rust',
    'grpc',
    'tonic',
    'axum',
    'postgres',
    'sqlx',
    'docker',
    'docker-compose',
  ]
status: 'finished'
image: '/portofolio/distributed-modular-monolith-paymentgateway-rust_1.png'
---

# Distributed Modular Monolith Payment Gateway in Rust

A production-ready payment gateway platform implementing a modular monolith architecture, built with Rust, gRPC, PostgreSQL, and React.

![Payment Gateway Dashboard](/portofolio/distributed-modular-monolith-paymentgateway-rust_1.png)

## Project Overview

This project demonstrates a comprehensive payment gateway system designed to simulate digital financial transactions. Built with a modular monolith architecture, the system separates business domains (users, balances, transactions) into independent modules within a single codebase. Inter-module communication is efficiently handled through gRPC.

The primary goal is to provide a real-world example of modern architecture implementation in the Rust ecosystem, complete with a backend, frontend dashboard, and desktop application version.

## Key Features

- **User Management & JWT Authentication**: Secure registration, login, and session management
- **Role-Based Access Control (RBAC)**: Feature access restriction based on user roles
- **Digital Wallet Management**: Balance top-up and utilization for transactions
- **Financial Transactions**:
  - Top-up from external sources
  - Peer-to-peer transfers
  - Withdrawal to external accounts
- **Payment Card Management**: Users can link and manage payment cards
- **Administrative Dashboard**: Interface for monitoring and managing system activities
- **Inter-Service Communication**: Efficient, type-safe communication via gRPC

## Architecture

The system is designed as a modular monolith. Although contained within a single repository, it consists of several services (crates) that communicate with each other through gRPC. This design provides clear separation of concerns while simplifying deployment and development compared to a full microservices architecture.

The `APIGateway` serves as the single entry point for all external HTTP requests. It handles request authentication and forwards them to the appropriate internal services via gRPC. All services share a single PostgreSQL database.

[![](https://mermaid.ink/img/pako:eNp1k1-PmkAUxb_KZJ400VVUEEmziYL_NbFKs0lhH64yK2RhhgxDt9b43TsstWW7w33yd86Zizc394pPLCDYwmcOaYhcx6dIVpYfS8HH6zgiFDWeyLHjkOxVsLTp4zJV1NhzIAuPDHiAOmi8WyK7eCCeywihgU8_9TxEmSAJ2sElkVE0B0He4FJtO2kUrf4Y6MuRP6KF6-46--nBbd47_td1AxegQNF5v7NRY8uCPEZLKginEH_4z0XZ3jgXIToQ_iM6keePpuN9ywivMaeeXQyrNmfeAeKA1bhzb0v4KQQ5szqw8PYsJjXm0nNZmqc17spzOdAMTiJitCazLjMvtbNtvKdIhAGHN0Wgssuitl7DAQFHyEi5oB3LxJmTw9dN8_P2x6jdfkSTO04klosqZFslOipxqhJnKnGuEhcqcakSVypxrRI395lK3JbgVGFahVkV5lVYVGFZhVUV1lXYlIBb8oKjAFsvEGekhRPCEygYX4ucj0VIEuJjS_4MgL8W53CTj1Kg3xlLsCV4Lp9xlp_Dv03yNJAH6EQgL-xfRC6VcJvlVGBL67-3wNYV_8RWuz960Ie9QU8zR11jVJgXqQ4GD7o-MHTT6Gqmqff7xq2Ff71_VXvomVrXHA51Q9ONUU8b3H4DuvI6tg?type=png)](https://mermaid.live/edit#pako:eNp1k1-PmkAUxb_KZJ400VVUEEmziYL_NbFKs0lhH64yK2RhhgxDt9b43TsstWW7w33yd86Zizc394pPLCDYwmcOaYhcx6dIVpYfS8HH6zgiFDWeyLHjkOxVsLTp4zJV1NhzIAuPDHiAOmi8WyK7eCCeywihgU8_9TxEmSAJ2sElkVE0B0He4FJtO2kUrf4Y6MuRP6KF6-46--nBbd47_td1AxegQNF5v7NRY8uCPEZLKginEH_4z0XZ3jgXIToQ_iM6keePpuN9ywivMaeeXQyrNmfeAeKA1bhzb0v4KQQ5szqw8PYsJjXm0nNZmqc17spzOdAMTiJitCazLjMvtbNtvKdIhAGHN0Wgssuitl7DAQFHyEi5oB3LxJmTw9dN8_P2x6jdfkSTO04klosqZFslOipxqhJnKnGuEhcqcakSVypxrRI395lK3JbgVGFahVkV5lVYVGFZhVUV1lXYlIBb8oKjAFsvEGekhRPCEygYX4ucj0VIEuJjS_4MgL8W53CTj1Kg3xlLsCV4Lp9xlp_Dv03yNJAH6EQgL-xfRC6VcJvlVGBL67-3wNYV_8RWuz960Ie9QU8zR11jVJgXqQ4GD7o-MHTT6Gqmqff7xq2Ff71_VXvomVrXHA51Q9ONUU8b3H4DuvI6tg)

## Database Schema

The following diagram illustrates the relationships between tables in the database:

[![](https://mermaid.ink/img/pako:eNqVll2PojAUhv8K6bUaUUHkzoyzWTOZzWTW2YuNCTkDVYjQklLWcR3_-1K-ocCO3BjOez6etqcHr8imDkYmwmzjwZFBsCdK8sQRZpFyzV7Es_2xS42W5ygvT5X91_r14fv6VTl4LOIEAixLPvQpOADPl80hRNGZMidTbtkPoz6WiISxjyjVqrq3amFWZ65SaSesL_3bUzdAYS9g8YHhyLU4PWEiU9fVr1YrlpUGVebd9vnx5279_KLgj9BjwD1KGig2MEciEMZ7C6cxJA7eMesR-SWsHfJmvXvMoLDlAG8eQwS-QyWs1Np3nrX60jFwysG33sEHYjcLBZjZLhAu1SqEdrm3t-2mEgmVQbp7GULPOuHL8H7mUJyGcSgRpdZOnEzpYhneFBEFAY0J7-ojoQaYu7R50TgDEoEtGklGrLRu0Jp-L24btH1I7T0UpQ4dU6oQ-gGF2EVXigdGg-7LV3hwKm93odUXksOePe46DM4SbCF0wpbivVtZBrZQ6rP983M8ptf6PDSVPXIh2qP6wP2vWyNba-4NuWZzacijurrCi55J6ZbF5m75KGllarjk923Qpd71LccKpM-ZYRt7f_BA6rRThWuEifMVv8GUVT-VqGiEjsxzkHkAP8IjlEAnX9fkHaUtt0fcxcncQiLAAXYSeW9JUAjkN6UBMjmLkzBG46NbJolDMbnzfwalS7ICzB5EZyFzlWZA5hV9IHM8X0205WwxU43VVF-p8xG6JNbFYqJpC10z9KlqGNp8rt9G6G9aVJ3MDHVqLJearmr6aqYubv8A6iOSyQ?type=png)](https://mermaid.live/edit#pako:eNqVll2PojAUhv8K6bUaUUHkzoyzWTOZzWTW2YuNCTkDVYjQklLWcR3_-1K-ocCO3BjOez6etqcHr8imDkYmwmzjwZFBsCdK8sQRZpFyzV7Es_2xS42W5ygvT5X91_r14fv6VTl4LOIEAixLPvQpOADPl80hRNGZMidTbtkPoz6WiISxjyjVqrq3amFWZ65SaSesL_3bUzdAYS9g8YHhyLU4PWEiU9fVr1YrlpUGVebd9vnx5279_KLgj9BjwD1KGig2MEciEMZ7C6cxJA7eMesR-SWsHfJmvXvMoLDlAG8eQwS-QyWs1Np3nrX60jFwysG33sEHYjcLBZjZLhAu1SqEdrm3t-2mEgmVQbp7GULPOuHL8H7mUJyGcSgRpdZOnEzpYhneFBEFAY0J7-ojoQaYu7R50TgDEoEtGklGrLRu0Jp-L24btH1I7T0UpQ4dU6oQ-gGF2EVXigdGg-7LV3hwKm93odUXksOePe46DM4SbCF0wpbivVtZBrZQ6rP983M8ptf6PDSVPXIh2qP6wP2vWyNba-4NuWZzacijurrCi55J6ZbF5m75KGllarjk923Qpd71LccKpM-ZYRt7f_BA6rRThWuEifMVv8GUVT-VqGiEjsxzkHkAP8IjlEAnX9fkHaUtt0fcxcncQiLAAXYSeW9JUAjkN6UBMjmLkzBG46NbJolDMbnzfwalS7ICzB5EZyFzlWZA5hV9IHM8X0205WwxU43VVF-p8xG6JNbFYqJpC10z9KlqGNp8rt9G6G9aVJ3MDHVqLJearmr6aqYubv8A6iOSyQ)

## Technology Stack

**Backend:**

- **Language**: Rust (Stable)
- **Async Runtime**: `tokio`
- **Communication**: `tonic` (gRPC) & `prost`
- **Database ORM**: `sqlx` (with PostgreSQL)
- **Web Framework (API Gateway)**: `axum`
- **Logging**: `tracing`
- **Validation**: `validator`

**Frontend (Dashboard):**

- **Framework**: React.js
- **Language**: TypeScript
- **Build Tool**: Vite
- **Styling**: Tailwind CSS
- **Desktop Application**: Tauri

**Infrastructure:**

- **Database**: PostgreSQL
- **API Definition**: Protocol Buffers (gRPC)

## Installation & Setup

### Prerequisites

Ensure the following software is installed:

- [Rust & Cargo](https://www.rust-lang.org/tools/install)
- [Node.js & npm](https://nodejs.org/) (or `bun`)
- [`sqlx-cli`](https://github.com/launchbadge/sqlx/tree/main/sqlx-cli) (`cargo install sqlx-cli`)
- [`protoc`](https://grpc.io/docs/protoc-installation/) (Protocol Buffers Compiler)

### Local Setup

1. **Clone the Repository**

   ```bash
   git clone https://github.com/MamangRust/example-payment-gateway-sqlx.git
   cd example-payment-gateway-sqlx
   ```

2. **Configure Environment Variables**
   Copy the `.env.example` file (if available) or create a new `.env` file in the project root and fill in your local configuration details.

   ```env
   # Example .env file content
   DATABASE_URL="postgres://user:password@localhost:5432/payment_gateway"
   APP_PORT=8000
   # URLs for each service...
   AUTH_SERVICE_URL="http://127.0.0.1:50051"
   USER_SERVICE_URL="http://127.0.0.1:50052"
   # ...and so on
   ```

3. **Run Database Migrations**
   Ensure your `DATABASE_URL` in the `.env` file is correct, then run the migrations.

   ```bash
   sqlx migrate run
   ```

4. **Build Protocol Buffer Definitions**
   Compile the `.proto` files for use by all services.

   ```bash
   cargo build -p genproto
   ```

5. **Build All Backend Services**
   ```bash
   cargo build --workspace
   ```

## Running the Application

1. **Start Backend Services**
   Open multiple terminal tabs and run each service separately.

   ```bash
   # Terminal 1: API Gateway
   cargo run -p apigateway

   # Terminal 2: Auth Service
   cargo run -p auth

   # Terminal 3: User Service
   cargo run -p user

   # ...run other services as needed
   ```

2. **Start the Frontend Dashboard**
   Open a new terminal in the `crates/dashboard` directory.

   ```bash
   cd crates/dashboard
   npm install
   npm run dev
   ```

   The frontend application will be available at `http://localhost:1420`.

3. **Run the Dashboard as a Desktop Application (Tauri)**
   ```bash
   cd crates/dashboard
   npm install
   npm run tauri dev
   ```

## API Documentation

Once the `apigateway` is running, the API documentation (generated with Swagger UI) can be accessed at:
[http://127.0.0.1:5000/swagger-ui/](http://127.0.0.1:5000/swagger-ui/)

## Application Screenshots

**Main Dashboard:**
![Example Dashboard](https://github.com/MamangRust/example-payment-gateway-sqlx/raw/main/backend/images/example-dashboard.png)

**API Documentation (Swagger UI):**
![Swagger UI](https://github.com/MamangRust/example-payment-gateway-sqlx/raw/main/backend/images/swagger-ui.png)

## ðŸ”— Source Code & Repository

[ðŸ“Œ View on GitHub](https://github.com/MamangRust/example-payment-gateway-sqlx)

---

# Performance & Scalability Analysis

This document summarizes the performance, scalability, and failure behavior of selected read-only modules under various traffic patterns. The goal is to establish an early scalability baseline, validate system stability, and observe graceful degradation under load.

**Test Environment:**

- Deployment: Docker Compose (single-node)
- Load testing tool: k6
- Scope: Read-only endpoints

## User Module Performance Analysis

| Test Type       | VUs  | Throughput | Error Rate | p95 Latency | Key Findings                                                  |
| --------------- | ---- | ---------- | ---------- | ----------- | ------------------------------------------------------------- |
| Smoke Test      | 1    | -          | 0%         | ~26 ms      | All endpoints responded correctly with low latency            |
| Capability Test | 900  | ~900 RPS   | 0%         | ~460 ms     | Sustained high volume with controlled concurrency limiting    |
| Load Test       | 1000 | ~1.9k RPS  | 0%         | ~690 ms     | Increased tail latency, acceptable for short bursts           |
| Stress Test     | 1500 | -          | ~43%       | -           | System entered intentional degradation with protective limits |
| Spike Test      | 1000 | -          | 0%         | -           | Absorbed traffic spikes without errors or instability         |

**Conclusion:** The User module demonstrates **strong scalability characteristics** and predictable degradation behavior under load, making it suitable for production deployment with horizontal scaling and rate limiting.

## Role Module Performance Analysis

| Test Type       | VUs  | Throughput | Error Rate | p95 Latency | Key Findings                                                     |
| --------------- | ---- | ---------- | ---------- | ----------- | ---------------------------------------------------------------- |
| Smoke Test      | 1    | -          | 0%         | ~18 ms      | All endpoints responded correctly with minimal latency           |
| Capability Test | 900  | ~1.1k RPS  | 0%         | ~470 ms     | Sustained high volume with intentional backpressure              |
| Load Test       | 1000 | ~1.3k RPS  | 0%         | ~1.22 s     | Increased tail latency, not recommended for continuous operation |
| Stress Test     | 1500 | -          | ~45%       | -           | Controlled degradation with protected downstream resources       |
| Spike Test      | 1000 | -          | 0%         | -           | Handled sudden traffic surges without instability                |

## Card Module Performance Analysis

| Test Type       | VUs  | Throughput  | Error Rate | p95 Latency | Key Findings                                            |
| --------------- | ---- | ----------- | ---------- | ----------- | ------------------------------------------------------- |
| Smoke Test      | 1    | -           | 0%         | ~19 ms      | All endpoints responded correctly with very low latency |
| Capability Test | 900  | ~4.7k req/s | 0%         | ~550 ms     | Intentional backpressure with controlled throughput     |
| Load Test       | 1000 | ~2.0k req/s | 0%         | ~619 ms     | Increased latency due to aggregation-heavy endpoints    |
| Stress Test     | 1500 | ~1.8k req/s | 0%         | ~844 ms     | Controlled degradation with stable downstream services  |
| Spike Test      | 1000 | -           | 0%         | ~925 ms     | Absorbed traffic spikes with temporary latency increase |

**Summary:** The Card module is **functionally stable** and **resilient under load**, with stats-heavy endpoints being the primary latency drivers. Further improvements should focus on caching aggregated stats and query optimization.

## Performance Test Visualizations

### Card Module

| Test Type           | Visualization                                                                                                                                                         |
| ------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| Capability Test     | <img src="/portofolio/distributed-modular-monolith-paymentgateway-rust/card/capability.png" alt="Card module capability test results" width="500" />                  |
| Load Test           | <img src="/portofolio/distributed-modular-monolith-paymentgateway-rust/card/load_test.png" alt="Card module load test results near capacity" width="500" />           |
| Stress & Spike Test | <img src="/portofolio/distributed-modular-monolith-paymentgateway-rust/card/stres_test_and_spike.png" alt="Card module stress and spike test behavior" width="500" /> |

### Role Module

| Test Type           | Visualization                                                                                                                                                       |
| ------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| Capability Test     | <img src="/portofolio/distributed-modular-monolith-paymentgateway-rust/role/capability.png" alt="Role module capability test results" width="500" />                |
| Load Test           | <img src="/portofolio/distributed-modular-monolith-paymentgateway-rust/role/load_test.png" alt="Role module load test results near capacity" width="500" />         |
| Stress & Spike Test | <img src="/portofolio/distributed-modular-monolith-paymentgateway-rust/role/spike_and_rampling.png" alt="Role module stress and spike test behavior" width="500" /> |

### User Module

| Test Type       | Visualization                                                                                                                                                      |
| --------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| Capability Test | <img src="/portofolio/distributed-modular-monolith-paymentgateway-rust/user/capability.png" alt="User module capability test results" width="500" />               |
| Load Test       | <img src="/portofolio/distributed-modular-monolith-paymentgateway-rust/user/load_test.png" alt="User module load test results near capacity" width="500" />        |
| Stress Test     | <img src="/portofolio/distributed-modular-monolith-paymentgateway-rust/user/strest_test.png" alt="User module stress test behavior beyond capacity" width="500" /> |
| Spike Test      | <img src="/portofolio/distributed-modular-monolith-paymentgateway-rust/user/spike_test.png" alt="User module spike test results" width="500" />                    |

**Notes on Visualizations:**

- All charts are generated from **k6 summary outputs**
- Throughput drops indicate **intentional concurrency limiting**
- Latency growth without error spikes confirms **graceful degradation**
- No evidence of cascading failures (DB, memory, thread pool)
