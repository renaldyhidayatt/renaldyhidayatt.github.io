---
title: 'Payment Gateway with Echo and gRPC'
excerpt: 'A system that simulates a payment gateway handling transactions like card payments, top-ups, withdrawals, and transfers.'
date: '2025-05-31'
tags:
  [
    'golang',
    'sqlc',
    'echo',
    'grpc',
    'postgres',
    'rust',
    'tauri.js',
    'axios',
    'zustand',
  ]
status: 'selesai'
image: '/portofolio/paymentgateway_grpc.png'
---

# Payment Gateway gRPC Project

This project is a **simple payment system implementation** designed to mimic the workflow of a typical digital financial service. The system is built with a modular approach, where each service can operate independently but remains interconnected through a consistent database and API.

### Core Features

The key components that form the core of this project include:

- **üîê User Authentication**
  Supports new account registration, login with credentials, and JWT token issuance and validation. The system also includes refresh token management to maintain user session security.

- **üí≥ Card Management**
  Each user can add cards to their account. Card details such as number, card type, expiration date, and CVV are stored securely and can be accessed for transactions.

- **üè¨ Merchant Management**
  Merchants can be created and managed through the system. Each merchant has a unique identity in the form of a UUID merchant number and an API key used to process transactions.

- **üí∏ Transactions**
  Handles the payment process between a user's card and a merchant. Each transaction is recorded with a unique number, payment amount, and information about the receiving merchant.

- **üîÑ Fund Transfers**
  Allows users to transfer balances between cards. The system records the source (from) and destination (to) of the transfer, ensuring sufficient balance before processing the transaction.

- **üìà Balance Top-Up**
  Users can add funds to their cards through a top-up process. Each top-up has a unique identity and automatically updates the respective card's balance.

- **üèß Withdrawals**
  Users can withdraw funds from their cards. Like top-ups, this process is recorded, and the balance is updated according to the withdrawal amount.

- **üí∞ Balance Management**
  All cards are linked to a balance entity. The system is responsible for tracking, adding, and subtracting balances consistently after every financial operation (transaction, transfer, top-up, or withdrawal).

---

## üöÄ Project Features

- **REST API Client**: A RESTful client that interacts with the gRPC server.
- **gRPC Server**: The main server that handles all business logic.
- **Database Migration**: Uses `goose` to manage the database schema.
- **API Documentation**: Automatically generated Swagger documentation.
- **Docker Support**: Docker and Docker Compose configurations for an easy development environment.
- **Unit & Integration Tests**: Testing to ensure code reliability.
- **CI/CD**: GitHub Actions workflows for automated builds, formatting, and testing.

## üß∞ Technology Stack

- üêπ **Go (Golang)** ‚Äî Implementation language.
- üåê **Echo** ‚Äî A minimalist web framework for building REST APIs.
- ü™µ **Zap Logger** ‚Äî Structured logging for high-performance applications.
- üì¶ **SQLC** ‚Äî Generates type-safe Go code from SQL queries.
- üöÄ **gRPC** ‚Äî High-performance RPC for internal service communication.
- üß≥ **Goose** ‚Äî A migration tool for managing database schema changes.
- üê≥ **Docker** ‚Äî A containerization platform for consistent development environments.
- üìÑ **Swago** ‚Äî Generates Swagger 2.0 documentation for Echo routes.
- üîó **Docker Compose** ‚Äî Manages multi-container Docker applications.

---

## Architecture

This application is designed with a service-oriented monolithic architecture. The client-facing REST API acts as a gateway, translating HTTP requests into gRPC calls to the backend server. This server contains the core business logic and communicates with a PostgreSQL database.

[![](https://mermaid.ink/img/pako:eNqdUl1vmzAU_SuWI02pRNIAgRg_TKqaaevWrazJ00IeLuGGoICNjGmbRfnvMx9ZO1WbtNqS4R7fe865to90IxOknKYKyh1ZziNBzKjquAMieiM0KthXGQlRpGktIKJdUjPOGBmNTO6n5TK8vP-wWJLh58Xdt4uIGvw9-ZJnKFbtenkV3pCPoPERDuuOBkUSiVeyt3AAAYJclXm2hyp7KdoydYrpfXhNhqGSWsb19iy4QPWAatV9SJOzfq7u0bZ88f22L5mDhhgqXA1DWelUodm6-KfDpnUsYhCpsfmO3JXmmP70-TVLG2hl7FVYncP136Rfi-lDjn232yzP-SBxmR_EVqWV3CMfuBuXuX4fjh6zRO-4Uz5ZG5lLxQcOa-ZLrr73joy54AXs7WRn3z1dzOLY8d9O1x9Pz7ZFNrGD_2OjlnnGWUL5FvIKLVqgKqCJ6bERiqjeYYER5eY3AbVv7upkikoQP6QsKNeqNmVK1unuN0ldJua5zjMw7p5TzC2hupa10JQ7dktB-ZE-UT5yg7E3c6aOzYKJH9iuRQ8GnU7Hnjf1PeZPbMY81_VPFv3Zqtpjh9kTNpt5vu35gWNPT78AlHgbkQ?type=png)](https://mermaid.live/edit#pako:eNqdUl1vmzAU_SuWI02pRNIAgRg_TKqaaevWrazJ00IeLuGGoICNjGmbRfnvMx9ZO1WbtNqS4R7fe865to90IxOknKYKyh1ZziNBzKjquAMieiM0KthXGQlRpGktIKJdUjPOGBmNTO6n5TK8vP-wWJLh58Xdt4uIGvw9-ZJnKFbtenkV3pCPoPERDuuOBkUSiVeyt3AAAYJclXm2hyp7KdoydYrpfXhNhqGSWsb19iy4QPWAatV9SJOzfq7u0bZ88f22L5mDhhgqXA1DWelUodm6-KfDpnUsYhCpsfmO3JXmmP70-TVLG2hl7FVYncP136Rfi-lDjn232yzP-SBxmR_EVqWV3CMfuBuXuX4fjh6zRO-4Uz5ZG5lLxQcOa-ZLrr73joy54AXs7WRn3z1dzOLY8d9O1x9Pz7ZFNrGD_2OjlnnGWUL5FvIKLVqgKqCJ6bERiqjeYYER5eY3AbVv7upkikoQP6QsKNeqNmVK1unuN0ldJua5zjMw7p5TzC2hupa10JQ7dktB-ZE-UT5yg7E3c6aOzYKJH9iuRQ8GnU7Hnjf1PeZPbMY81_VPFv3Zqtpjh9kTNpt5vu35gWNPT78AlHgbkQ)

---

## Database Schema (ERD)

The following diagram illustrates the relationships between the tables in the database.

[![](https://mermaid.ink/img/pako:eNqVVm1v2jAQ_iuRpUqbRBEBEkK-odJpVaVpQu0-TEjITQyxSOzIcaAM-O-zHfLS2KEln8g9z909dz5fOIKAhgj4ALE5hhsGkyWxxJNniGXWsXiRz9OvF2Vc4dD6_Vzb_8wWDz9nC2uNWcYJTJAOxbALQQnEsW5OYZbtKQsL5LwkxQ9GY6RpksYuTQqrM1eBVB3GaBXSDtks_8ezWUJpr_IEkIVaCmn8avSyEOVD8uQNsQ6QH9JGf-ezl0cLvaeYoVUIuaHzwW7XEpsgFkSQcE1wCbRFv74-zWuQUD2J-dBhildbdLhefSUrg3FINU3K2nXsjW5pZ8Uph_HqDcaQBO2x4AySDAYcU6IlbGDGPjRxUyuuaYIJzQnvbrrWE5VsbbigJdAtUYImfRW4ZjQxzmDF4FTvaok1S6nl0jRPda3SahaqkFu7WHgZBewxj0IG95qGEjDKqMBblVSORjEMrRnKItHGLdLn7AN665pQTq10d3fWAsVQDXWExTF8eySbGGfR9-aiP53u7-nxsrB8awkimC2BgVFviWusVo1G6llQT8fmLm7RCuOntELzJfFlW0gK3RMz58M1v84sBvcqp56tz5OqKytp8pJ9gcZpSarb3lUEQwHCOySygx7YMBwCfw3jDPWA8BWfWfEO1KyJsBESexlIrxCyrcxxFk4pJH8pTYDPWS7cGM03URUkT-V35PIXoaIgEiL2IIcc-PZEhQD-EbwD_3407TuT4Xhoe9OBO7VHPXAQ1vG47zhj1_Hcge15zmjknnvgn8pq94eePfAmE8e1HXc6tMfn_2iJl2c?type=png)](https://mermaid.live/edit#pako:eNqVVm1v2jAQ_iuRpUqbRBEBEkK-odJpVaVpQu0-TEjITQyxSOzIcaAM-O-zHfLS2KEln8g9z909dz5fOIKAhgj4ALE5hhsGkyWxxJNniGXWsXiRz9OvF2Vc4dD6_Vzb_8wWDz9nC2uNWcYJTJAOxbALQQnEsW5OYZbtKQsL5LwkxQ9GY6RpksYuTQqrM1eBVB3GaBXSDtks_8ezWUJpr_IEkIVaCmn8avSyEOVD8uQNsQ6QH9JGf-ezl0cLvaeYoVUIuaHzwW7XEpsgFkSQcE1wCbRFv74-zWuQUD2J-dBhildbdLhefSUrg3FINU3K2nXsjW5pZ8Uph_HqDcaQBO2x4AySDAYcU6IlbGDGPjRxUyuuaYIJzQnvbrrWE5VsbbigJdAtUYImfRW4ZjQxzmDF4FTvaok1S6nl0jRPda3SahaqkFu7WHgZBewxj0IG95qGEjDKqMBblVSORjEMrRnKItHGLdLn7AN665pQTq10d3fWAsVQDXWExTF8eySbGGfR9-aiP53u7-nxsrB8awkimC2BgVFviWusVo1G6llQT8fmLm7RCuOntELzJfFlW0gK3RMz58M1v84sBvcqp56tz5OqKytp8pJ9gcZpSarb3lUEQwHCOySygx7YMBwCfw3jDPWA8BWfWfEO1KyJsBESexlIrxCyrcxxFk4pJH8pTYDPWS7cGM03URUkT-V35PIXoaIgEiL2IIcc-PZEhQD-EbwD_3407TuT4Xhoe9OBO7VHPXAQ1vG47zhj1_Hcge15zmjknnvgn8pq94eePfAmE8e1HXc6tMfn_2iJl2c)

---

## Getting Started

You can run this project either locally with a Go environment or using Docker.

### Prerequisites

- Go (version 1.21 or newer)
- Docker and Docker Compose
- The `make` command-line tool
- An `.env` file with the necessary environment variables. You can copy from `docker.env` as a template.

### 1. Clone the Repository

```bash
git clone https://github.com/MamangRust/payment-gateway-grpc.git
cd payment-gateway-grpc
```

### 2. Running with Docker (Recommended)

This is the easiest way to run all services.

1.  **Create Environment File:**
    Copy `docker.env` to a new `.env` file.

    ```bash
    cp docker.env .env
    ```

2.  **Build and Run Services:**
    Use the `make` command to build the images and start the containers in detached mode.

    ```bash
    make docker-up
    ```

    This will start the `postgres`, `migrate`, `server`, and `client` services. The client will be available at `http://localhost:5000`.

3.  **Stopping Services:**
    To stop all running containers, use:
    ```bash
    make docker-down
    ```

### 3. Running Locally

1.  **Start the Database:**
    You can use the provided Docker Compose file to run only the PostgreSQL database.

    ```bash
    docker-compose up -d postgres
    ```

2.  **Set Up Environment:**
    Create an `.env` file in the root directory and fill in the database connection details and other required variables.

3.  **Run Database Migrations:**
    Apply the latest database schema.

    ```bash
    make migrate
    ```

4.  **Run Services:**
    Open two separate terminal windows.

    In the first terminal, run the gRPC server:

    ```bash
    make run-server
    ```

    In the second terminal, run the client:

    ```bash
    make run-client
    ```

    The client API will be accessible at `http://localhost:5000`.

---

## Available `make` Commands

- `migrate`: Applies database migrations.
- `migrate-down`: Reverts the last database migration.
- `run-server`: Starts the gRPC server locally.
- `run-client`: Starts the client API gateway locally.
- `docker-up`: Builds and starts all services with Docker Compose.
- `docker-down`: Stops and removes all services started with Docker Compose.
- `test`: Runs unit tests.
- `test-all`: Runs all tests (unit and integration).
- `fmt`: Formats the Go source code.
- `lint`: Lints the codebase.
- `generate-proto`: Generates Go code from Protobuf files.

---

## Preview

### Swagger API Documentation

<img src="/portofolio/payment-gateway-grpc/swagger_3.png" alt="swagger" />

### Frontend Preview

#### Web

<img
  src="/portofolio/payment-gateway-grpc/preview_payment.png"
  alt="Web Frontend Preview"
/>

#### Desktop

<img
  src="/portofolio/payment-gateway-grpc/preview_payment_desktop.png"
  alt="Desktop Frontend Preview"
/>

## Performance & Scalability Summary (k6)

<h3>User Module</h3>
<table>
  <thead>
    <tr>
      <th>Test Type</th>
      <th>VUs</th>
      <th>Throughput (req/s)</th>
      <th>Error Rate</th>
      <th>p95 Latency</th>
      <th>Notes</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Smoke</td>
      <td>1</td>
      <td>‚Äì</td>
      <td>0%</td>
      <td>&lt;10 ms</td>
      <td>Baseline validated</td>
    </tr>
    <tr>
      <td>Capability</td>
      <td>150</td>
      <td>~960</td>
      <td>~0%</td>
      <td>~6‚Äì7 ms</td>
      <td>Highly efficient, CPU-light</td>
    </tr>
    <tr>
      <td>Load</td>
      <td>1000</td>
      <td>~3800</td>
      <td>0%</td>
      <td>~386 ms</td>
      <td>Tail latency increases but stable</td>
    </tr>
    <tr>
      <td>Stress</td>
      <td>1500</td>
      <td>~3560</td>
      <td>~0%</td>
      <td>~408 ms</td>
      <td>Graceful degradation</td>
    </tr>
    <tr>
      <td>Spike</td>
      <td>1000</td>
      <td>~3235</td>
      <td>0%</td>
      <td>~336 ms</td>
      <td>Clean and fast recovery</td>
    </tr>
  </tbody>
</table>

<h3>Role Module</h3>
<table>
  <thead>
    <tr>
      <th>Test Type</th>
      <th>VUs</th>
      <th>Throughput (req/s)</th>
      <th>Error Rate</th>
      <th>p95 Latency</th>
      <th>Notes</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Smoke</td>
      <td>1</td>
      <td>‚Äì</td>
      <td>0%</td>
      <td>&lt;10 ms</td>
      <td>Baseline validated</td>
    </tr>
    <tr>
      <td>Capability</td>
      <td>154</td>
      <td>~1200</td>
      <td>0%</td>
      <td>~7.5 ms</td>
      <td>Similar to User, slightly heavier</td>
    </tr>
    <tr>
      <td>Load</td>
      <td>1000</td>
      <td>~4200</td>
      <td>~0%</td>
      <td>~333 ms</td>
      <td>p95 exceeds soft threshold</td>
    </tr>
    <tr>
      <td>Stress</td>
      <td>1500</td>
      <td>~3980</td>
      <td>~0%</td>
      <td>~349 ms</td>
      <td>Stable under sustained pressure</td>
    </tr>
    <tr>
      <td>Spike</td>
      <td>1000</td>
      <td>~3850</td>
      <td>0%</td>
      <td>~271 ms</td>
      <td>Fast recovery after spike</td>
    </tr>
  </tbody>
</table>

<h3>Card Module</h3>
<table>
  <thead>
    <tr>
      <th>Test Type</th>
      <th>VUs</th>
      <th>Throughput (req/s)</th>
      <th>Error Rate</th>
      <th>p95 Latency</th>
      <th>Notes</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Smoke</td>
      <td>1</td>
      <td>‚Äì</td>
      <td>0%</td>
      <td>&lt;100 ms</td>
      <td>Acceptable under low load</td>
    </tr>
    <tr>
      <td>Capability</td>
      <td>900</td>
      <td>~2240</td>
      <td>
        <strong>12.5%</strong>
      </td>
      <td>~797 ms</td>
      <td>Structural failure observed</td>
    </tr>
    <tr>
      <td>Load</td>
      <td>1000</td>
      <td>~2600</td>
      <td>
        <strong>12.5%</strong>
      </td>
      <td>~806 ms</td>
      <td>Latency and error thresholds breached</td>
    </tr>
    <tr>
      <td>Stress</td>
      <td>1500</td>
      <td>~3230</td>
      <td>
        <strong>12.5%</strong>
      </td>
      <td>~587 ms</td>
      <td>Consistent error pattern</td>
    </tr>
    <tr>
      <td>Spike</td>
      <td>1000</td>
      <td>~3088</td>
      <td>
        <strong>12.5%</strong>
      </td>
      <td>~360 ms</td>
      <td>Fast failure, consistent behavior</td>
    </tr>
  </tbody>
</table>

---

## Performance Test Visualizations

### Card Module

| Test Type       | Visualization                                                                                                                            |
| --------------- | ---------------------------------------------------------------------------------------------------------------------------------------- |
| Capability Test | <img src="/portofolio/payment-gateway-grpc/card/card_capability.png" alt="Card module capability test results" width="500" />            |
| Load Test       | <img src="/portofolio/payment-gateway-grpc/card/card_load_test.png" alt="Card module load test results near capacity" width="500" />     |
| Stress Test     | <img src="/portofolio/payment-gateway-grpc/card/card_rampling.png" alt="Card module stress test behavior beyond capacity" width="500" /> |
| Spike Test      | <img src="/portofolio/payment-gateway-grpc/card/card_spike.png" alt="Card module spike test results" width="500" />                      |

### Role Module

| Test Type       | Visualization                                                                                                                            |
| --------------- | ---------------------------------------------------------------------------------------------------------------------------------------- |
| Capability Test | <img src="/portofolio/payment-gateway-grpc/role/role_capability.png" alt="Role module capability test results" width="500" />            |
| Load Test       | <img src="/portofolio/payment-gateway-grpc/role/role_load_test.png" alt="Role module load test results near capacity" width="500" />     |
| Stress Test     | <img src="/portofolio/payment-gateway-grpc/role/role_rampling.png" alt="Role module stress test behavior beyond capacity" width="500" /> |
| Spike Test      | <img src="/portofolio/payment-gateway-grpc/role/role_spike.png" alt="Role module spike test results" width="500" />                      |

### User Module

| Test Type       | Visualization                                                                                                                            |
| --------------- | ---------------------------------------------------------------------------------------------------------------------------------------- |
| Capability Test | <img src="/portofolio/payment-gateway-grpc/user/user_capability.png" alt="User module capability test results" width="500" />            |
| Load Test       | <img src="/portofolio/payment-gateway-grpc/user/user_load_test.png" alt="User module load test results near capacity" width="500" />     |
| Stress Test     | <img src="/portofolio/payment-gateway-grpc/user/user_rampling.png" alt="User module stress test behavior beyond capacity" width="500" /> |
| Spike Test      | <img src="/portofolio/payment-gateway-grpc/user/user_spike.png" alt="User module spike test results" width="500" />                      |

## üîó Source Code & Repository

[üìå View on GitHub (Backend)](https://github.com/MamangRust/payment-gateway-grpc)
