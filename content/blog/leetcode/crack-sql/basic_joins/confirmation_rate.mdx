---
title: "Basic Joins in SQL"
description: "Introduction to fundamental SQL joins, including INNER JOIN, LEFT JOIN, RIGHT JOIN, and FULL JOIN, with examples and use cases."
tags: ["SQL", "joins", "INNER JOIN", "LEFT JOIN", "RIGHT JOIN", "FULL JOIN", "database"]
date: "2025-03-03"
published: false
---





## 1934. Confirmation Rate

### SQL Solution
To calculate the confirmation rate for each user, we need to compute the ratio of confirmed messages to total requested messages. For users who haven't requested any confirmation messages, the rate should be 0.


```sql
SELECT
    s.user_id,
    ROUND(COALESCE(SUM(CASE WHEN c.action = 'confirmed' THEN 1 ELSE 0 END) / COUNT(c.action), 0), 2) AS confirmation_rate
FROM
    Signups s
LEFT JOIN
    Confirmations c
ON
    s.user_id = c.user_id
GROUP BY
    s.user_id;
```

### Explanation

1. Join Tables:

- Use a LEFT JOIN to include all users from the Signups table, even if they don't have entries in the Confirmations table.


2. Count Confirmed Messages:

- Use CASE WHEN to count the number of 'confirmed' actions.

3. Calculate Total Requests:

- Use COUNT(c.action) to find the total number of confirmation messages.

4. Handle Missing Data:

- Use COALESCE to handle cases where there are no confirmations (NULL values), setting the rate to 0.

5. Round the Result:

- Use ROUND to round the confirmation rate to 2 decimal places.

6. Group by User:

- Group by s.user_id to compute the metrics for each user.

### MongoDB

In MongoDB, the aggregation framework can be used to compute the confirmation rate for each user.

### MongoDB Query
```js
db.signups.aggregate([
  {
    $lookup: {
      from: "confirmations",
      localField: "user_id",
      foreignField: "user_id",
      as: "confirmations"
    }
  },
  {
    $addFields: {
      total_requests: { $size: "$confirmations" },
      confirmed_count: {
        $size: {
          $filter: {
            input: "$confirmations",
            as: "confirmation",
            cond: { $eq: ["$$confirmation.action", "confirmed"] }
          }
        }
      }
    }
  },
  {
    $addFields: {
      confirmation_rate: {
        $cond: [
          { $eq: ["$total_requests", 0] },
          0,
          { $round: [{ $divide: ["$confirmed_count", "$total_requests"] }, 2] }
        ]
      }
    }
  },
  {
    $project: {
      _id: 0,
      user_id: 1,
      confirmation_rate: 1
    }
  }
]);

```

### Explanation
1. Join Tables:

- Use $lookup to join Signups with Confirmations based on user_id.

2. Count Confirmations:

- Use $filter to count the number of 'confirmed' actions in the confirmations array.

3. Count Total Requests:

- Use $size to calculate the total number of requests (length of the confirmations array).

4. Calculate Confirmation Rate:

- Use $divide to calculate the confirmation rate.
- Handle cases where no requests exist using $cond.

5. Round the Result:

- Use $round to round the result to 2 decimal places.

6. Output Result:

- Use $project to include only user_id and confirmation_rate.


----------------------