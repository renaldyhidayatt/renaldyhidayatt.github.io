---
title: "Basic Joins in SQL"
description: "Introduction to fundamental SQL joins, including INNER JOIN, LEFT JOIN, RIGHT JOIN, and FULL JOIN, with examples and use cases."
tags: ["SQL", "joins", "INNER JOIN", "LEFT JOIN", "RIGHT JOIN", "FULL JOIN", "database"]
date: "2025-03-03"
published: false
---



## 1581. Customer Who Visited but Did Not Make Any Transactions

### Problem Statement

The goal of this problem is to find the customers who visited a mall but did not make any transactions, and to count how many times these customers visited without making any transactions. A customer can have multiple visits, and some of those visits may involve transactions, while others may not.

### Input Tables Structure

#### Visits Table

The `Visits` table contains the following columns:

- **`visit_id`**: The unique identifier for each visit (Primary Key).
- **`customer_id`**: The identifier of the customer who visited the mall.

#### Transactions Table

The `Transactions` table contains the following columns:

- **`transaction_id`**: The unique identifier for each transaction (Primary Key).
- **`visit_id`**: The identifier of the visit associated with the transaction (Foreign Key to `Visits` table).
- **`amount`**: The amount spent in the transaction.

### Problem Breakdown

- You need to find the customers who visited the mall but did not make any transactions.
- For each of those customers, you also need to count how many visits they made without transactions.

---

### Example Input

#### Visits Table

```table
| visit_id | customer_id |
|----------|-------------|
| 1        | 23          |
| 2        | 9           |
| 4        | 30          |
| 5        | 54          |
| 6        | 96          |
| 7        | 54          |
| 8        | 54          |


```

#### Transactions Table

```table
| transaction_id | visit_id | amount |
|----------------|----------|--------|
| 2              | 5        | 310    |
| 3              | 5        | 300    |
| 9              | 5        | 200    |
| 12             | 1        | 910    |
| 13             | 2        | 970    |
```

#### Example Output

```table
| customer_id | count_no_trans |
|-------------|----------------|
| 54          | 2              |
| 30          | 1              |
| 96          | 1              |
```

#### Explanation:
- Customer with ID = 23: Made one transaction during visit 1.
- Customer with ID = 9: Made one transaction during visit 2.
- Customer with ID = 30: Visited once without making a transaction.
- Customer with ID = 54: Visited three times. Two visits had no transactions, and one had multiple transactions.
- Customer with ID = 96: Visited once without making any transactions.


### SQL Implementation
In SQL, we can use a LEFT JOIN to find visits with no transactions, group by customer, and count the visits without transactions.

### SQL Query

```sql
SELECT v.customer_id, COUNT(v.visit_id) AS count_no_trans
FROM Visits v
LEFT JOIN Transactions t ON v.visit_id = t.visit_id
WHERE t.transaction_id IS NULL
GROUP BY v.customer_id;
```

### Explanation:
- ``LEFT JOIN``: We use a LEFT JOIN to include all visits, even those without a matching transaction. This ensures that visits without transactions will have NULL values in the Transactions table.
- ``WHERE t.transaction_id IS NULL``: This condition filters out the visits that have corresponding transactions, leaving only those without transactions.
- ``GROUP BY v.customer_id``: This groups the result by customer_id, counting how many visits each customer made without transactions.


### NoSQL (MongoDB) Implementation
In MongoDB, we can use the aggregation framework to achieve the same result. We can use $lookup to join the Visits collection with the Transactions collection, $match to filter visits without transactions, and $group to count them.

### MongoDB Query

```js
db.visits.aggregate([
  {
    $lookup: {
      from: "transactions",
      localField: "visit_id",
      foreignField: "visit_id",
      as: "transaction_info"
    }
  },
  {
    $match: {
      "transaction_info": { $size: 0 }
    }
  },
  {
    $group: {
      _id: "$customer_id",
      count_no_trans: { $sum: 1 }
    }
  },
  {
    $project: {
      customer_id: "$_id",
      count_no_trans: 1,
      _id: 0
    }
  }
]);
```

### Explanation:
- ``$lookup``: This stage joins the visits collection with the transactions collection based on the visit_id. It creates an array of transaction_info for each visit.
- ``$match``: This stage filters for visits where the transaction_info array is empty ($size: 0), meaning these visits had no transactions.
- ``$group``: This groups the result by customer_id and counts how many visits the customer made without transactions ($sum: 1).
- ``$project``: This reshapes the output to show only the customer_id and count_no_trans, removing the _id field.

-------------------