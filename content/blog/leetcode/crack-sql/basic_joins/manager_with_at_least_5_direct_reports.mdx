---
title: "Basic Joins in SQL"
description: "Introduction to fundamental SQL joins, including INNER JOIN, LEFT JOIN, RIGHT JOIN, and FULL JOIN, with examples and use cases."
tags: ["SQL", "joins", "INNER JOIN", "LEFT JOIN", "RIGHT JOIN", "FULL JOIN", "database"]
date: "2025-03-03"
published: false
---




## 570. Managers with at Least 5 Direct Reports


The task is to find managers with at least five direct reports based on the Employee table. The managerId column identifies the manager for each employee. If managerId is null, the employee does not have a manager. An employee can directly report to only one manager.

### SQL Solution

The SQL query should group employees by their managerId, count the number of direct reports, and filter managers with at least five direct reports.

#### SQL Query

```sql
SELECT
    e1.name
FROM
    Employee e1
JOIN
    Employee e2
ON
    e1.id = e2.managerId
GROUP BY
    e1.id, e1.name
HAVING
    COUNT(e2.id) >= 5;
```

### Explanation
1. Join Table:

  - Join the Employee table with itself (e1 and e2) on e1.id = e2.managerId to match managers with their direct reports.

2. Group by Manager:

  - Group by the manager's id and name to calculate the number of direct reports.

3. Filter Managers:

  - Use HAVING COUNT(e2.id) >= 5 to include only managers with at least 5 direct reports.

4. Select Name:

  - Retrieve the names of managers.

### MongoDB Solution
In MongoDB, use the aggregation framework to group by managerId and count the number of direct reports. Then filter for managers with at least five direct reports and fetch their names.

### MongoDB Query

```js
db.employees.aggregate([
  {
    $match: { managerId: { $ne: null } } // Ignore employees without managers
  },
  {
    $group: {
      _id: "$managerId",
      directReports: { $sum: 1 }
    }
  },
  {
    $match: { directReports: { $gte: 5 } } // Filter managers with at least 5 reports
  },
  {
    $lookup: {
      from: "employees",
      localField: "_id",
      foreignField: "id",
      as: "manager"
    }
  },
  {
    $unwind: "$manager"
  },
  {
    $project: {
      _id: 0,
      name: "$manager.name"
    }
  }
]);
```

### Explanation
1. Filter by Manager Presence:

- Exclude records where managerId is null.

2. Group by managerId:

- Use $group to count the number of direct reports for each manager.

3. Filter by Direct Reports:

- Use $match to include only managers with at least 5 direct reports.

4. Lookup Manager Details:

- Use $lookup to fetch the manager's details (like name) by matching id with managerId.

5. Format Output:

- Use $project to display only the manager's name.

----------------

